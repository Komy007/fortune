<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª…ë¦¬í•™ ë¶„ì„ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .result { margin: 10px 0; padding: 10px; background: #f0f0f0; }
        button { padding: 10px 20px; margin: 5px; }
        input { padding: 5px; margin: 5px; }
    </style>
</head>
<body>
    <h1>ëª…ë¦¬í•™ ë¶„ì„ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-section">
        <h2>1. í˜„ì¬ ì‚¬ìš©ì ì •ë³´ í™•ì¸</h2>
        <button onclick="checkCurrentUser()">ì‚¬ìš©ì ì •ë³´ í™•ì¸</button>
        <div id="userInfo" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. ëª…ë¦¬í•™ ë¶„ì„ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testBaziAnalysis()">ëª…ë¦¬í•™ ë¶„ì„ ì‹¤í–‰</button>
        <div id="baziResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. API ì§ì ‘ í…ŒìŠ¤íŠ¸</h2>
        <label>ìƒë…„: <input type="number" id="testYear" value="1990"></label>
        <label>ìƒì›”: <input type="number" id="testMonth" value="1"></label>
        <label>ìƒì¼: <input type="number" id="testDay" value="1"></label>
        <label>ìƒì‹œ: <input type="number" id="testHour" value="12"></label>
        <button onclick="testDirectAPI()">API ì§ì ‘ í˜¸ì¶œ</button>
        <div id="apiResult" class="result"></div>
    </div>

    <script>
        function checkCurrentUser() {
            const userInfo = document.getElementById('userInfo');
            const currentUser = localStorage.getItem('currentUser');
            const authToken = localStorage.getItem('authToken');
            
            userInfo.innerHTML = `
                <h3>localStorage ì •ë³´:</h3>
                <p><strong>currentUser:</strong> ${currentUser || 'ì—†ìŒ'}</p>
                <p><strong>authToken:</strong> ${authToken ? 'ìˆìŒ' : 'ì—†ìŒ'}</p>
                ${currentUser ? `<p><strong>íŒŒì‹±ëœ ì‚¬ìš©ì:</strong> <pre>${JSON.stringify(JSON.parse(currentUser), null, 2)}</pre></p>` : ''}
            `;
        }
        
        async function testBaziAnalysis() {
            const resultDiv = document.getElementById('baziResult');
            resultDiv.innerHTML = 'ë¶„ì„ ì¤‘...';
            
            try {
                const currentUser = localStorage.getItem('currentUser');
                if (!currentUser) {
                    resultDiv.innerHTML = 'âŒ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.';
                    return;
                }
                
                const user = JSON.parse(currentUser);
                const authToken = localStorage.getItem('authToken');
                
                if (!authToken) {
                    resultDiv.innerHTML = 'âŒ ì¸ì¦ í† í°ì´ ì—†ìŠµë‹ˆë‹¤.';
                    return;
                }
                
                const requestData = {
                    birth_year: parseInt(user.birthYear || user.birth_year),
                    birth_month: parseInt(user.birthMonth || user.birth_month),
                    birth_day: parseInt(user.birthDay || user.birth_day),
                    birth_hour: parseInt(user.birthHour || user.birth_hour) || 12
                };
                
                console.log('ğŸ“¤ ì „ì†¡í•  ë°ì´í„°:', requestData);
                
                const response = await fetch('http://localhost:3000/api/bazi', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(requestData)
                });
                
                console.log('ğŸ“¥ ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    resultDiv.innerHTML = `âŒ ì˜¤ë¥˜: ${response.status} - ${errorText}`;
                    return;
                }
                
                const result = await response.json();
                resultDiv.innerHTML = `
                    <h3>âœ… ë¶„ì„ ì„±ê³µ!</h3>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
                
            } catch (error) {
                resultDiv.innerHTML = `âŒ ì˜¤ë¥˜: ${error.message}`;
                console.error('í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
            }
        }
        
        async function testDirectAPI() {
            const resultDiv = document.getElementById('apiResult');
            resultDiv.innerHTML = 'API í˜¸ì¶œ ì¤‘...';
            
            try {
                const authToken = localStorage.getItem('authToken');
                if (!authToken) {
                    resultDiv.innerHTML = 'âŒ ì¸ì¦ í† í°ì´ ì—†ìŠµë‹ˆë‹¤.';
                    return;
                }
                
                const requestData = {
                    birth_year: parseInt(document.getElementById('testYear').value),
                    birth_month: parseInt(document.getElementById('testMonth').value),
                    birth_day: parseInt(document.getElementById('testDay').value),
                    birth_hour: parseInt(document.getElementById('testHour').value)
                };
                
                console.log('ğŸ“¤ ì§ì ‘ API ì „ì†¡ ë°ì´í„°:', requestData);
                
                const response = await fetch('http://localhost:3000/api/bazi/simple', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(requestData)
                });
                
                console.log('ğŸ“¥ ì§ì ‘ API ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    resultDiv.innerHTML = `âŒ ì˜¤ë¥˜: ${response.status} - ${errorText}`;
                    return;
                }
                
                const result = await response.json();
                resultDiv.innerHTML = `
                    <h3>âœ… ì§ì ‘ API ì„±ê³µ!</h3>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
                
            } catch (error) {
                resultDiv.innerHTML = `âŒ ì˜¤ë¥˜: ${error.message}`;
                console.error('ì§ì ‘ API í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
            }
        }
    </script>
</body>
</html>
