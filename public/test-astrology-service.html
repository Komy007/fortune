<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì ì„±ìˆ  ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #f9f9f9;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .error {
            color: red;
            background: #ffe6e6;
            border-color: #ffcccc;
        }
        .success {
            color: green;
            background: #e6ffe6;
            border-color: #ccffcc;
        }
        .loading {
            color: blue;
            background: #e6f3ff;
            border-color: #b3d9ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”® ì ì„±ìˆ  ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸</h1>
        
        <div class="form-group">
            <label for="birthYear">ì¶œìƒë…„ë„:</label>
            <select id="birthYear">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="birthMonth">ì¶œìƒì›”:</label>
            <select id="birthMonth">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="birthDay">ì¶œìƒì¼:</label>
            <select id="birthDay">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="birthHour">ì¶œìƒì‹œê°„:</label>
            <select id="birthHour">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            </select>
        </div>
        
        <button onclick="testAstrology()">ì ì„±ìˆ  ë¶„ì„ í…ŒìŠ¤íŠ¸</button>
        <button onclick="clearResult()">ê²°ê³¼ ì§€ìš°ê¸°</button>
        
        <div id="result" class="result"></div>
    </div>

    <script>
        // ë…„ë„ ì˜µì…˜ ìƒì„± (1950-2024)
        const yearSelect = document.getElementById('birthYear');
        for (let year = 2024; year >= 1950; year--) {
            const option = document.createElement('option');
            option.value = year;
            option.textContent = year + 'ë…„';
            yearSelect.appendChild(option);
        }

        // ì›” ì˜µì…˜ ìƒì„±
        const monthSelect = document.getElementById('birthMonth');
        for (let month = 1; month <= 12; month++) {
            const option = document.createElement('option');
            option.value = month;
            option.textContent = month + 'ì›”';
            monthSelect.appendChild(option);
        }

        // ì¼ ì˜µì…˜ ìƒì„±
        const daySelect = document.getElementById('birthDay');
        for (let day = 1; day <= 31; day++) {
            const option = document.createElement('option');
            option.value = day;
            option.textContent = day + 'ì¼';
            daySelect.appendChild(option);
        }

        // ì‹œê°„ ì˜µì…˜ ìƒì„±
        const hourSelect = document.getElementById('birthHour');
        for (let hour = 0; hour <= 23; hour++) {
            const option = document.createElement('option');
            option.value = hour;
            option.textContent = hour + 'ì‹œ';
            hourSelect.appendChild(option);
        }

        async function testAstrology() {
            const birthYear = document.getElementById('birthYear').value;
            const birthMonth = document.getElementById('birthMonth').value;
            const birthDay = document.getElementById('birthDay').value;
            const birthHour = document.getElementById('birthHour').value;
            
            if (!birthYear || !birthMonth || !birthDay) {
                showResult('ì¶œìƒë…„ë„, ì›”, ì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = 'ë¶„ì„ ì¤‘...';
            resultDiv.className = 'result loading';
            
            try {
                const data = {
                    birth_year: parseInt(birthYear),
                    birth_month: parseInt(birthMonth),
                    birth_day: parseInt(birthDay),
                    birth_hour: parseInt(birthHour) || 0
                };
                
                console.log('ìš”ì²­ ë°ì´í„°:', data);
                
                const response = await fetch('/api/astrology', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify(data)
                });
                
                console.log('ì‘ë‹µ ìƒíƒœ:', response.status);
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(`ì„œë²„ ì˜¤ë¥˜ (${response.status}): ${errorData.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                }
                
                const result = await response.json();
                console.log('ì‘ë‹µ ë°ì´í„°:', result);
                
                if (result.success) {
                    const formattedResult = formatAstrologyResult(result.result);
                    showResult(formattedResult, 'success');
                } else {
                    showResult(`ë¶„ì„ ì‹¤íŒ¨: ${result.error}`, 'error');
                }
                
            } catch (error) {
                console.error('ì˜¤ë¥˜:', error);
                showResult(`ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
            }
        }

        function formatAstrologyResult(result) {
            return `
ğŸ”® ì ì„±ìˆ  ë¶„ì„ ê²°ê³¼

ğŸ“… ê¸°ë³¸ ì •ë³´:
- ë³„ìë¦¬: ${result.sunSign || 'ì•Œ ìˆ˜ ì—†ìŒ'}
- ì›ì†Œ: ${result.element || 'ì•Œ ìˆ˜ ì—†ìŒ'}
- í˜„ì¬ ë‚˜ì´: ${result.age || 'ì•Œ ìˆ˜ ì—†ìŒ'}ì„¸

ğŸŒŸ íŠ¹ì„±:
${result.characteristics || 'íŠ¹ì„± ì •ë³´ ì—†ìŒ'}

âœ¨ ì¥ì :
${result.strengths || 'ì¥ì  ì •ë³´ ì—†ìŒ'}

âš ï¸ ì£¼ì˜ì :
${result.weaknesses || 'ì£¼ì˜ì  ì •ë³´ ì—†ìŒ'}

ğŸ’¼ ì ì„±:
${result.career || 'ì ì„± ì •ë³´ ì—†ìŒ'}

â¤ï¸ ì‚¬ë‘ê´€:
${result.love || 'ì‚¬ë‘ê´€ ì •ë³´ ì—†ìŒ'}

ğŸ”® ${result.period || 'í˜„ì¬'} ìš´ì„¸:
${result.fortune || 'ìš´ì„¸ ì •ë³´ ì—†ìŒ'}

ğŸ’¡ ì¡°ì–¸:
${result.fortuneAdvice || 'ì¡°ì–¸ ì •ë³´ ì—†ìŒ'}

ğŸª í–‰ì„±ì˜ ì˜í–¥:
${result.planetaryInfluence || 'í–‰ì„± ì˜í–¥ ì •ë³´ ì—†ìŒ'}

ğŸ“ ìƒì„¸ ë¶„ì„:
${result.detailedAnalysis || 'ìƒì„¸ ë¶„ì„ ì •ë³´ ì—†ìŒ'}

ğŸ’¡ ê°œì¸ ì¡°ì–¸:
${(result.recommendations || []).map((rec, index) => `${index + 1}. ${rec}`).join('\n')}

ğŸ¯ ì—°ë ¹ëŒ€ë³„ ì¡°ì–¸:
${result.ageAdvice || 'ì—°ë ¹ëŒ€ë³„ ì¡°ì–¸ ì •ë³´ ì—†ìŒ'}

ğŸ¥ ê±´ê°• ì¡°ì–¸:
${result.healthAdvice || 'ê±´ê°• ì¡°ì–¸ ì •ë³´ ì—†ìŒ'}

ğŸ”¢ í–‰ìš´ ì •ë³´:
- í–‰ìš´ ìˆ«ì: ${(result.luckyNumbers || []).join(', ')}
- í–‰ìš´ ìƒ‰ìƒ: ${(result.luckyColors || []).join(', ')}
- í–‰ìš´ ìš”ì¼: ${(result.luckyDays || []).join(', ')}

ğŸ’• í˜¸í™˜ì„±:
${result.compatibility || 'í˜¸í™˜ì„± ì •ë³´ ì—†ìŒ'}

ğŸ“… ì›”ë³„ ìš´ì„¸:
${(result.monthlyHoroscope || []).map(month => `${month.month}: ${month.prediction}`).join('\n')}
            `;
        }

        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = message;
            resultDiv.className = `result ${type}`;
        }

        function clearResult() {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = '';
            resultDiv.className = 'result';
        }
    </script>
</body>
</html>
