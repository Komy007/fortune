<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>점성술 서비스 테스트</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #f9f9f9;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .error {
            color: red;
            background: #ffe6e6;
            border-color: #ffcccc;
        }
        .success {
            color: green;
            background: #e6ffe6;
            border-color: #ccffcc;
        }
        .loading {
            color: blue;
            background: #e6f3ff;
            border-color: #b3d9ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔮 점성술 서비스 테스트</h1>
        
        <div class="form-group">
            <label for="birthYear">출생년도:</label>
            <select id="birthYear">
                <option value="">선택하세요</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="birthMonth">출생월:</label>
            <select id="birthMonth">
                <option value="">선택하세요</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="birthDay">출생일:</label>
            <select id="birthDay">
                <option value="">선택하세요</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="birthHour">출생시간:</label>
            <select id="birthHour">
                <option value="">선택하세요</option>
            </select>
        </div>
        
        <button onclick="testAstrology()">점성술 분석 테스트</button>
        <button onclick="clearResult()">결과 지우기</button>
        
        <div id="result" class="result"></div>
    </div>

    <script>
        // 년도 옵션 생성 (1950-2024)
        const yearSelect = document.getElementById('birthYear');
        for (let year = 2024; year >= 1950; year--) {
            const option = document.createElement('option');
            option.value = year;
            option.textContent = year + '년';
            yearSelect.appendChild(option);
        }

        // 월 옵션 생성
        const monthSelect = document.getElementById('birthMonth');
        for (let month = 1; month <= 12; month++) {
            const option = document.createElement('option');
            option.value = month;
            option.textContent = month + '월';
            monthSelect.appendChild(option);
        }

        // 일 옵션 생성
        const daySelect = document.getElementById('birthDay');
        for (let day = 1; day <= 31; day++) {
            const option = document.createElement('option');
            option.value = day;
            option.textContent = day + '일';
            daySelect.appendChild(option);
        }

        // 시간 옵션 생성
        const hourSelect = document.getElementById('birthHour');
        for (let hour = 0; hour <= 23; hour++) {
            const option = document.createElement('option');
            option.value = hour;
            option.textContent = hour + '시';
            hourSelect.appendChild(option);
        }

        async function testAstrology() {
            const birthYear = document.getElementById('birthYear').value;
            const birthMonth = document.getElementById('birthMonth').value;
            const birthDay = document.getElementById('birthDay').value;
            const birthHour = document.getElementById('birthHour').value;
            
            if (!birthYear || !birthMonth || !birthDay) {
                showResult('출생년도, 월, 일을 모두 선택해주세요.', 'error');
                return;
            }
            
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = '분석 중...';
            resultDiv.className = 'result loading';
            
            try {
                const data = {
                    birth_year: parseInt(birthYear),
                    birth_month: parseInt(birthMonth),
                    birth_day: parseInt(birthDay),
                    birth_hour: parseInt(birthHour) || 0
                };
                
                console.log('요청 데이터:', data);
                
                const response = await fetch('/api/astrology', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify(data)
                });
                
                console.log('응답 상태:', response.status);
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(`서버 오류 (${response.status}): ${errorData.error || '알 수 없는 오류'}`);
                }
                
                const result = await response.json();
                console.log('응답 데이터:', result);
                
                if (result.success) {
                    const formattedResult = formatAstrologyResult(result.result);
                    showResult(formattedResult, 'success');
                } else {
                    showResult(`분석 실패: ${result.error}`, 'error');
                }
                
            } catch (error) {
                console.error('오류:', error);
                showResult(`오류 발생: ${error.message}`, 'error');
            }
        }

        function formatAstrologyResult(result) {
            return `
🔮 점성술 분석 결과

📅 기본 정보:
- 별자리: ${result.sunSign || '알 수 없음'}
- 원소: ${result.element || '알 수 없음'}
- 현재 나이: ${result.age || '알 수 없음'}세

🌟 특성:
${result.characteristics || '특성 정보 없음'}

✨ 장점:
${result.strengths || '장점 정보 없음'}

⚠️ 주의점:
${result.weaknesses || '주의점 정보 없음'}

💼 적성:
${result.career || '적성 정보 없음'}

❤️ 사랑관:
${result.love || '사랑관 정보 없음'}

🔮 ${result.period || '현재'} 운세:
${result.fortune || '운세 정보 없음'}

💡 조언:
${result.fortuneAdvice || '조언 정보 없음'}

🪐 행성의 영향:
${result.planetaryInfluence || '행성 영향 정보 없음'}

📝 상세 분석:
${result.detailedAnalysis || '상세 분석 정보 없음'}

💡 개인 조언:
${(result.recommendations || []).map((rec, index) => `${index + 1}. ${rec}`).join('\n')}

🎯 연령대별 조언:
${result.ageAdvice || '연령대별 조언 정보 없음'}

🏥 건강 조언:
${result.healthAdvice || '건강 조언 정보 없음'}

🔢 행운 정보:
- 행운 숫자: ${(result.luckyNumbers || []).join(', ')}
- 행운 색상: ${(result.luckyColors || []).join(', ')}
- 행운 요일: ${(result.luckyDays || []).join(', ')}

💕 호환성:
${result.compatibility || '호환성 정보 없음'}

📅 월별 운세:
${(result.monthlyHoroscope || []).map(month => `${month.month}: ${month.prediction}`).join('\n')}
            `;
        }

        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = message;
            resultDiv.className = `result ${type}`;
        }

        function clearResult() {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = '';
            resultDiv.className = 'result';
        }
    </script>
</body>
</html>
