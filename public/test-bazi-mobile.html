<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë§ˆíŠ¸í° ëª…ë¦¬í•™ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: white;
        }
        .test-section {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .log {
            background: #000;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        .error {
            color: #ff6b6b;
        }
        .success {
            color: #51cf66;
        }
        .info {
            color: #74c0fc;
        }
    </style>
</head>
<body>
    <h1>ğŸ“± ìŠ¤ë§ˆíŠ¸í° ëª…ë¦¬í•™ ë¶„ì„ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-section">
        <h3>ğŸ” í˜„ì¬ ìƒíƒœ í™•ì¸</h3>
        <button onclick="checkCurrentState()">í˜„ì¬ ìƒíƒœ í™•ì¸</button>
        <button onclick="checkLocalStorage()">localStorage í™•ì¸</button>
        <button onclick="checkUserInfo()">ì‚¬ìš©ì ì •ë³´ í™•ì¸</button>
        <div id="currentState" class="log"></div>
    </div>
    
    <div class="test-section">
        <h3>ğŸš€ ëª…ë¦¬í•™ ë¶„ì„ í…ŒìŠ¤íŠ¸</h3>
        <button onclick="testBaziAnalysis()">ëª…ë¦¬í•™ ë¶„ì„ ì‹¤í–‰</button>
        <button onclick="testChangeSection()">ëª…ë¦¬í•™ ì„¹ì…˜ ì´ë™</button>
        <div id="baziTest" class="log"></div>
    </div>
    
    <div class="test-section">
        <h3>ğŸ“Š ì‹¤ì‹œê°„ ë¡œê·¸</h3>
        <button onclick="clearLogs()">ë¡œê·¸ ì§€ìš°ê¸°</button>
        <div id="realtimeLog" class="log"></div>
    </div>

    <script>
        // ë¡œê·¸ í•¨ìˆ˜
        function log(message, type = 'info') {
            const logDiv = document.getElementById('realtimeLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // í˜„ì¬ ìƒíƒœ í™•ì¸
        function checkCurrentState() {
            const stateDiv = document.getElementById('currentState');
            stateDiv.innerHTML = '';
            
            log('=== í˜„ì¬ ìƒíƒœ í™•ì¸ ì‹œì‘ ===', 'info');
            
            // í™”ë©´ í¬ê¸°
            const screenInfo = {
                width: window.innerWidth,
                height: window.innerHeight,
                isMobile: window.innerWidth <= 768
            };
            log(`í™”ë©´ í¬ê¸°: ${screenInfo.width}x${screenInfo.height}, ëª¨ë°”ì¼: ${screenInfo.isMobile}`, 'info');
            
            // localStorage
            const authToken = localStorage.getItem('authToken');
            const currentUser = localStorage.getItem('currentUser');
            log(`ì¸ì¦ í† í°: ${authToken ? 'ìˆìŒ' : 'ì—†ìŒ'}`, authToken ? 'success' : 'error');
            log(`ì‚¬ìš©ì ì •ë³´: ${currentUser ? 'ìˆìŒ' : 'ì—†ìŒ'}`, currentUser ? 'success' : 'error');
            
            // í˜„ì¬ URL
            log(`í˜„ì¬ URL: ${window.location.href}`, 'info');
            
            // DOM ìš”ì†Œ í™•ì¸
            const baziSection = document.getElementById('bazi');
            const baziResult = document.getElementById('baziResult');
            const myBaziInfo = document.getElementById('myBaziInfo');
            
            log(`ëª…ë¦¬í•™ ì„¹ì…˜: ${baziSection ? 'ì°¾ìŒ' : 'ì—†ìŒ'}`, baziSection ? 'success' : 'error');
            log(`ê²°ê³¼ ì»¨í…Œì´ë„ˆ: ${baziResult ? 'ì°¾ìŒ' : 'ì—†ìŒ'}`, baziResult ? 'success' : 'error');
            log(`ì‚¬ìš©ì ì •ë³´ ì»¨í…Œì´ë„ˆ: ${myBaziInfo ? 'ì°¾ìŒ' : 'ì—†ìŒ'}`, myBaziInfo ? 'success' : 'error');
            
            // ìƒíƒœ í‘œì‹œ
            stateDiv.innerHTML = `
                <div><strong>í™”ë©´ í¬ê¸°:</strong> ${screenInfo.width}x${screenInfo.height} (ëª¨ë°”ì¼: ${screenInfo.isMobile})</div>
                <div><strong>ì¸ì¦ í† í°:</strong> ${authToken ? 'âœ… ìˆìŒ' : 'âŒ ì—†ìŒ'}</div>
                <div><strong>ì‚¬ìš©ì ì •ë³´:</strong> ${currentUser ? 'âœ… ìˆìŒ' : 'âŒ ì—†ìŒ'}</div>
                <div><strong>ëª…ë¦¬í•™ ì„¹ì…˜:</strong> ${baziSection ? 'âœ… ì°¾ìŒ' : 'âŒ ì—†ìŒ'}</div>
                <div><strong>ê²°ê³¼ ì»¨í…Œì´ë„ˆ:</strong> ${baziResult ? 'âœ… ì°¾ìŒ' : 'âŒ ì—†ìŒ'}</div>
                <div><strong>ì‚¬ìš©ì ì •ë³´ ì»¨í…Œì´ë„ˆ:</strong> ${myBaziInfo ? 'âœ… ì°¾ìŒ' : 'âŒ ì—†ìŒ'}</div>
            `;
        }

        // localStorage í™•ì¸
        function checkLocalStorage() {
            log('=== localStorage í™•ì¸ ===', 'info');
            
            const authToken = localStorage.getItem('authToken');
            const currentUser = localStorage.getItem('currentUser');
            
            if (authToken) {
                log('ì¸ì¦ í† í° ë°œê²¬:', 'success');
                try {
                    const tokenParts = authToken.split('.');
                    if (tokenParts.length === 3) {
                        const payload = JSON.parse(atob(tokenParts[1]));
                        log(`í† í° í˜ì´ë¡œë“œ: ${JSON.stringify(payload, null, 2)}`, 'info');
                    }
                } catch (e) {
                    log(`í† í° íŒŒì‹± ì˜¤ë¥˜: ${e.message}`, 'error');
                }
            } else {
                log('ì¸ì¦ í† í° ì—†ìŒ', 'error');
            }
            
            if (currentUser) {
                log('ì‚¬ìš©ì ì •ë³´ ë°œê²¬:', 'success');
                try {
                    const user = JSON.parse(currentUser);
                    log(`ì‚¬ìš©ì ì •ë³´: ${JSON.stringify(user, null, 2)}`, 'info');
                } catch (e) {
                    log(`ì‚¬ìš©ì ì •ë³´ íŒŒì‹± ì˜¤ë¥˜: ${e.message}`, 'error');
                }
            } else {
                log('ì‚¬ìš©ì ì •ë³´ ì—†ìŒ', 'error');
            }
        }

        // ì‚¬ìš©ì ì •ë³´ í™•ì¸
        function checkUserInfo() {
            log('=== ì‚¬ìš©ì ì •ë³´ í™•ì¸ ===', 'info');
            
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                log('ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            try {
                const user = JSON.parse(currentUser);
                log('ì‚¬ìš©ì ì •ë³´ íŒŒì‹± ì„±ê³µ:', 'success');
                
                const birthInfo = {
                    birthYear: user.birthYear || user.birth_year,
                    birthMonth: user.birthMonth || user.birth_month,
                    birthDay: user.birthDay || user.birth_day,
                    birthHour: user.birthHour || user.birth_hour
                };
                
                log(`ìƒë…„ì›”ì¼ ì •ë³´: ${JSON.stringify(birthInfo, null, 2)}`, 'info');
                
                const hasCompleteInfo = birthInfo.birthYear && birthInfo.birthMonth && birthInfo.birthDay;
                log(`ì™„ì „í•œ ìƒë…„ì›”ì¼ ì •ë³´: ${hasCompleteInfo ? 'âœ… ìˆìŒ' : 'âŒ ì—†ìŒ'}`, hasCompleteInfo ? 'success' : 'error');
                
            } catch (e) {
                log(`ì‚¬ìš©ì ì •ë³´ íŒŒì‹± ì˜¤ë¥˜: ${e.message}`, 'error');
            }
        }

        // ëª…ë¦¬í•™ ë¶„ì„ í…ŒìŠ¤íŠ¸
        async function testBaziAnalysis() {
            log('=== ëª…ë¦¬í•™ ë¶„ì„ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===', 'info');
            
            const currentUser = localStorage.getItem('currentUser');
            const authToken = localStorage.getItem('authToken');
            
            if (!currentUser || !authToken) {
                log('ì‚¬ìš©ì ì •ë³´ ë˜ëŠ” ì¸ì¦ í† í°ì´ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            try {
                const user = JSON.parse(currentUser);
                log('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì„±ê³µ:', 'success');
                
                const birthYear = user.birthYear || user.birth_year;
                const birthMonth = user.birthMonth || user.birth_month;
                const birthDay = user.birthDay || user.birth_day;
                const birthHour = user.birthHour || user.birth_hour;
                
                if (!birthYear || !birthMonth || !birthDay) {
                    log('ìƒë…„ì›”ì¼ ì •ë³´ê°€ ë¶ˆì™„ì „í•©ë‹ˆë‹¤.', 'error');
                    return;
                }
                
                log(`ë¶„ì„í•  ìƒë…„ì›”ì¼: ${birthYear}ë…„ ${birthMonth}ì›” ${birthDay}ì¼ ${birthHour || 0}ì‹œ`, 'info');
                
                // API í˜¸ì¶œ í…ŒìŠ¤íŠ¸
                const requestData = {
                    birth_year: parseInt(birthYear),
                    birth_month: parseInt(birthMonth),
                    birth_day: parseInt(birthDay),
                    birth_hour: parseInt(birthHour) || 12
                };
                
                log(`API ìš”ì²­ ë°ì´í„°: ${JSON.stringify(requestData, null, 2)}`, 'info');
                
                const response = await fetch('http://localhost:3000/api/bazi', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(requestData)
                });
                
                log(`API ì‘ë‹µ ìƒíƒœ: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const result = await response.json();
                    log('API ì‘ë‹µ ì„±ê³µ:', 'success');
                    log(`ì‘ë‹µ ë°ì´í„°: ${JSON.stringify(result, null, 2)}`, 'info');
                } else {
                    const errorText = await response.text();
                    log(`API ì˜¤ë¥˜: ${errorText}`, 'error');
                }
                
            } catch (e) {
                log(`ë¶„ì„ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${e.message}`, 'error');
            }
        }

        // ëª…ë¦¬í•™ ì„¹ì…˜ ì´ë™ í…ŒìŠ¤íŠ¸
        function testChangeSection() {
            log('=== ëª…ë¦¬í•™ ì„¹ì…˜ ì´ë™ í…ŒìŠ¤íŠ¸ ===', 'info');
            
            // changeSection í•¨ìˆ˜ê°€ ìˆëŠ”ì§€ í™•ì¸
            if (typeof window.changeSection === 'function') {
                log('changeSection í•¨ìˆ˜ ë°œê²¬:', 'success');
                try {
                    window.changeSection('bazi');
                    log('changeSection í˜¸ì¶œ ì™„ë£Œ', 'success');
                } catch (e) {
                    log(`changeSection í˜¸ì¶œ ì˜¤ë¥˜: ${e.message}`, 'error');
                }
            } else {
                log('changeSection í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ë¡œê·¸ ì§€ìš°ê¸°
        function clearLogs() {
            document.getElementById('realtimeLog').innerHTML = '';
            log('ë¡œê·¸ê°€ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤.', 'info');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ìƒíƒœ í™•ì¸
        window.addEventListener('load', () => {
            log('ìŠ¤ë§ˆíŠ¸í° ëª…ë¦¬í•™ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œë¨', 'success');
            checkCurrentState();
        });
    </script>
</body>
</html>



