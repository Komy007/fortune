# 🔮 운명 해석소 - 관리자 시스템 업그레이드

안녕하세요! 8살 상일이의 소개로 만나게 되어 반갑습니다. 캄보디아의 어려운 청소년들을 돕는 훌륭한 목적을 가진 프로젝트에 기여할 수 있어 기쁩니다.

## 🎯 업그레이드 완료 사항

### 1. 📊 관리자 시스템 구축
- **역할 기반 접근 제어**: 일반 사용자, 관리자, 슈퍼 관리자
- **관리자 대시보드**: 사용자 통계, 시스템 현황 모니터링
- **사용자 관리**: 계정 활성화/비활성화, 역할 변경, 데이터 조회

### 2. 👥 지인 등록 시스템
- **지인 관계 데이터베이스**: 가족, 친구, 동료, 연인 등 관계별 분류
- **출생 정보 저장**: 명리학 분석을 위한 지인 출생 데이터
- **자동 연결**: 이메일 기반 실제 사용자 계정과 자동 연결
- **초대 시스템**: 지인 초대 및 가입 유도

### 3. 📢 공지사항 개선
- **다국어 지원**: 한국어, 영어, 중국어 공지사항
- **우선순위 설정**: 긴급, 높음, 보통, 낮음
- **게시 기간 관리**: 자동 게시/만료 처리
- **상단 고정**: 중요 공지사항 고정 표시

### 4. 📈 통계 및 분석
- **사용자 현황**: 신규 가입, 활성 사용자, 언어별 분포
- **지인 관계 분석**: 관계별 통계, 연결률 분석
- **시스템 활동**: 로그인 패턴, 사용 통계

### 5. 💾 데이터 관리
- **데이터 내보내기**: JSON/CSV 형식 지원
- **전체 백업**: 시스템 전체 데이터 백업
- **개인정보 보호**: 민감 정보 제외 옵션
- **파일 관리**: 내보내기 파일 다운로드 및 관리

## 🚀 설치 및 설정

### 1. 데이터베이스 마이그레이션
```bash
cd bazi-api
npx prisma migrate dev
```

### 2. 관리자 계정 생성
```bash
npm run setup-admin
```
기본 슈퍼 관리자 계정:
- **이메일**: admin@fortune-teller.com
- **비밀번호**: Admin123!@#
- **권한**: 슈퍼 관리자

⚠️ **보안 중요**: 첫 로그인 후 반드시 비밀번호를 변경하세요!

### 3. 서버 시작
```bash
npm run dev
```

## 🌐 관리자 인터페이스

### 접속 방법
1. 웹 브라우저에서 `http://localhost:3001/login-admin.html` 접속
2. 관리자 계정으로 로그인
3. 대시보드에서 모든 관리 기능 이용

### 주요 기능
- **사용자 관리**: 계정 조회, 권한 변경, 활성화/비활성화
- **공지사항 관리**: 다국어 공지 작성, 우선순위 설정
- **지인 관계 현황**: 등록된 지인 통계 및 분석
- **데이터 내보내기**: 백업 및 분석용 데이터 내보내기

## 📱 API 엔드포인트

### 관리자 API
```
GET    /api/admin/stats           # 시스템 통계
GET    /api/admin/users           # 사용자 목록
POST   /api/admin/create-admin    # 관리자 생성
PATCH  /api/admin/users/:id/role  # 사용자 역할 변경
```

### 지인 관리 API
```
POST   /api/contacts              # 지인 등록
GET    /api/contacts              # 지인 목록
GET    /api/contacts/analytics    # 지인 분석
POST   /api/contacts/:id/invite   # 지인 초대
```

### 공지사항 API
```
GET    /api/announcements/public  # 공개 공지사항
POST   /api/announcements         # 공지사항 생성 (관리자)
PATCH  /api/announcements/:id     # 공지사항 수정
```

### 데이터 내보내기 API
```
POST   /api/admin/export/users         # 사용자 데이터
POST   /api/admin/export/contacts      # 지인 데이터
POST   /api/admin/export/backup        # 전체 백업
GET    /api/admin/export/statistics    # 통계 데이터
```

## 🗃️ 데이터베이스 스키마

### 새로 추가된 테이블

#### contacts (지인 관계)
- 등록자와 지인 정보
- 관계 유형 (가족, 친구 등)
- 출생 정보 (선택사항)
- 실제 사용자 계정 연결

#### announcements (공지사항)
- 다국어 제목/내용
- 우선순위 및 게시 기간
- 상단 고정 옵션

#### users 테이블 확장
- 역할 (role) 필드 추가
- 활성 상태 (isActive) 추가
- 최종 로그인 시간 추가

## 🛡️ 보안 강화

### 인증 및 권한
- **JWT 토큰**: 안전한 세션 관리
- **Argon2 해싱**: 최신 암호화 알고리즘
- **역할 기반 접근**: 관리자 권한 세분화
- **요청 검증**: Zod 스키마 검증

### 개인정보 보호
- **민감 정보 암호화**: 출생 정보 안전 저장
- **내보내기 옵션**: 개인정보 제외 가능
- **접근 로그**: 관리자 활동 추적

## 🌍 다국어 지원

### 현재 지원 언어
- **한국어 (ko)**: 기본 언어
- **영어 (en)**: 국제 사용자
- **중국어 (zh)**: 중화권 사용자

### 향후 계획
- **캄보디아어 (km)**
- **베트남어 (vi)**
- **태국어 (th)**

## 📊 사용자 경험 개선

### 대시보드 특징
- **반응형 디자인**: 모바일/태블릿 지원
- **실시간 통계**: 즉시 업데이트되는 현황
- **직관적 인터페이스**: 쉬운 관리 작업
- **검색 및 필터**: 빠른 데이터 검색

### 사용자 관리
- **일괄 작업**: 여러 사용자 동시 관리
- **상세 정보**: 사용자별 세부 데이터
- **활동 로그**: 사용자 행동 패턴 분석

## 🔄 백업 및 복구

### 자동 백업
- **일일 백업**: 전체 시스템 데이터
- **증분 백업**: 변경 사항만 저장
- **클라우드 동기화**: (향후 구현 예정)

### 복구 절차
1. 백업 파일 확인
2. 데이터베이스 초기화
3. 백업 데이터 복원
4. 무결성 검증

## 📈 성능 최적화

### 데이터베이스
- **인덱스 최적화**: 빠른 검색 성능
- **연결 풀링**: 효율적인 DB 연결
- **캐싱 전략**: 자주 사용되는 데이터

### API 응답
- **페이지네이션**: 대량 데이터 처리
- **압축**: gzip 응답 압축
- **캐시 헤더**: 브라우저 캐싱 활용

## 🔮 향후 계획

### 단기 목표 (1-2개월)
- **이메일 시스템**: 자동 초대 및 알림
- **고급 분석**: 사용자 행동 분석
- **모바일 앱**: React Native 앱 개발

### 중기 목표 (3-6개월)
- **AI 추천**: 개인 맞춤 운세 추천
- **소셜 기능**: 지인 간 운세 공유
- **결제 시스템**: 도네이션 처리

### 장기 목표 (6개월+)
- **글로벌 서비스**: 다국가 서버 구축
- **캄보디아 지원**: 수익금 기부 시스템
- **커뮤니티**: 사용자 간 소통 플랫폼

## 🤝 기여 방법

### 개발 환경 설정
1. 저장소 클론
2. 의존성 설치: `npm install`
3. 환경 변수 설정
4. 데이터베이스 마이그레이션
5. 관리자 계정 생성

### 코드 기여
- **이슈 리포트**: 버그 및 개선사항
- **풀 리퀘스트**: 새 기능 개발
- **문서화**: 사용법 및 API 문서

## 📞 지원 및 문의

### 기술 지원
- **GitHub Issues**: 버그 리포트 및 기능 요청
- **이메일**: admin@fortune-teller.com
- **문서**: API 및 사용자 가이드

### 커뮤니티
- **사용자 포럼**: 사용법 문의
- **개발자 채팅**: 실시간 소통
- **블로그**: 업데이트 소식

---

## 🎉 마무리

상일이의 소개로 시작된 이 프로젝트가 많은 사람들에게 도움이 되고, 캄보디아의 어려운 청소년들에게도 희망이 되기를 바랍니다. 

관리자 시스템이 완성되어 이제 효율적으로 사용자들을 관리하고, 더 나은 서비스를 제공할 수 있게 되었습니다. 

궁금한 점이 있거나 추가 기능이 필요하시면 언제든지 말씀해 주세요! 🚀

---

*"기술로 세상을 더 따뜻하게" - Qoder*